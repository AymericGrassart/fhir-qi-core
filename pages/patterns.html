---
# jekyll header
---

{% include header.html %}

{% include container-start.html %}

<div class="col-12">
  <a name="patterns"> </a>
  <h2>QI-Core - Patterns<a href="patterns.html#patterns" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h2>

<blockquote>
    NOTE: The examples throughout this topic have been simplified to illustrate specific usage.
    Refer to the originating context for complete expressions.
</blockquote>

	<a name="Observation_Examples"> </a>
	<h3>Observations<a href="patterns.html#Observation_Examples" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h3>
  <p>For observations that have established profiles in US-Core, QI-Core uses those profiles:</p>
  <table class="list">
      <tr><th class="col-2">Profile</th><th class="col-10">Description</th></tr>
      <tr><td><a class="external free" href="{{site.data.fhir.path}}observation-vitalsigns.html" rel="nofollow">Vital Signs Profile</a></td><td>The FHIR Vital Signs profile sets minimum expectations for the Observation resource to record, search and fetch the vital signs associated with a patient that include the primary vital signs plus additional measurements such as height, weight and BMI.</td></tr>
      <tr><td><a class="external free" href="http://hl7.org/fhir/us/core/STU3/StructureDefinition-us-core-smokingstatus.html" rel="nofollow">Smoking Status Profile</a></td><td>This profile sets minimum expectations for the Observation resource to record, search and fetch smoking status data associated with a patient.</td></tr>
      <tr><td><a class="external free" href="http://hl7.org/fhir/us/core/STU3/StructureDefinition-us-core-observation-lab.html" rel="nofollow">Laboratory Result Profile</a></td><td>This profile sets minimum expectations for the Observation resource resource to record, search and fetch laboratory test results associated with a patient.</td></tr>
      <tr><td><a class="external free" href="http://hl7.org/fhir/us/core/STU3/StructureDefinition-pediatric-bmi-for-age.html" rel="nofollow">Pediatric Bmi For Age Profile</a></td><td>This profile sets minimum expectations for the Observation resource to record, search and fetch pediatric body mass index (BMI) per age and gender observations associated with a patient.</td></tr>
      <tr><td><a class="external free" href="http://hl7.org/fhir/us/core/STU3/StructureDefinition-pediatric-weight-for-height.html" rel="nofollow">Pediatric Weight For Height Profile</a></td><td>This profile sets minimum expectations for the Observation resource to record, search and fetch pediatric weight for height and age observations associated with a patient.</td></tr>
  </table>

  <p>For all other observations, use the <a href="StructureDefinition-qicore-observation.html">QICore-Observation</a> profile.</p>

<a name="Encounter_Examples"> </a>
<h3>Encounter Examples<a href="patterns.html#Encounter_Examples" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h3>

<a name="Inpatient_Encounter_Example"> </a>
<h4>Inpatient Encounter Example<a href="patterns.html#Inpatient_Encounter_Example" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: MATGlobalCommonFunctions</p>

<pre>
<code>
define "Inpatient Encounter":
    [Encounter: "Encounter Inpatient"] EncounterInpatient
        where EncounterInpatient.status = 'finished'
        and "LengthInDays"(EncounterInpatient.period) &lt;= 120
        and EncounterInpatient.period ends during "Measurement Period"
</code>
</pre>

<a name="Inpatient_Encounter_with_Pricipal_Diagnosis"> </a>
<h4>Inpatient Encounter with Principal Diagnosis<a href="patterns.html#Inpatient_Encounter_with_Pricipal_Diagnosis" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: EXM105</p>

<pre>
<code>
define "Inpatient Encounter with Principal Diagnosis of Ischemic Stroke":
    "Inpatient Encounter" Encounter
            let PrincipalDiagnosis:
                    (singleton from (Encounter.diagnosis D where D.role ~ ToConcept("Billing") and D.rank = 1)) PD
                return singleton from ([Condition: id in Last(Split(PD.condition.reference, '/'))])
            where PrincipalDiagnosis.code in "Ischemic Stroke"
</code>
</pre>

<p>Note that the FHIRHelpers.ToConcept usage is intended to be implicit and will be unnecessary once QUICK is fully supported.</p>

<a name="Inpatient_Encounter_with_Principal_Procedure"> </a>
<h4>Inpatient Encounter with Principal Procedure<a href="patterns.html#Inpatient_Encounter_with_Principal_Procedure" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: VTE-1</p>

<pre>
<code>
define "Inpatient Encounter With Principal Procedure of SCIP VTE Selected Surgery":
  "Inpatient Encounter" Encounter
	  let PrincipalProcedure:
		  singleton from (
			  Encounter.extension E
				  where E.url = 'http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter-procedure'
					  and exists (E.extension I where I.url = 'type' and I.value ~ "Primary procedure")
					return singleton from (
							E.extension I where I.url = 'procedure' return GetProcedure(I.value)
						)
			)
		where PrincipalProcedure.code in "SCIP VTE Selected Surgery"

define function GetProcedure(reference Reference):
  singleton from ["Procedure": id in GetId(reference.reference))]

define function GetId(uri String):
  Last(Split(uri, '/'))
    </code>
</pre>

<a name="Diagnosis_Examples"> </a>
<h3>Diagnosis Examples<a href="patterns.html#Diagnosis_Examples" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h3>

<p>Example source: EXM72_FHIR-8.1.0_TJC.cql</p>

<pre>
<code>
define "Condition of Intravenous or Intra arterial Thrombolytic (tPA) Therapy Prior to Arrival":
    Condition: "Intravenous or Intra arterial Thrombolytic (tPA) Therapy Prior to Arrival"] PriorTPA
        where clinicalStatus in { 'active', 'recurrence', 'relapse' }
</code>
</pre>

<p>Note that verificationStatus is not being checked due to feedback received that it may be difficult for implementers to retrieve the element.</p>

<a name="Medications"> </a>
<h3>Medications<a href="patterns.html#Medications" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h3>

<p>Example source: EXM108_FHIR</p>

<pre>
<code>
define "VTE Prophylaxis by Medication Administered":
    ["MedicationAdministration": medication in "Low Dose Unfractionated Heparin for VTE Prophylaxis"] VTEMedication
        where VTEMedication.status = 'completed'
            and VTEMedication.dosage.route in "Subcutaneous route"
</code>
</pre>

<a name="Medications_at_discharge"> </a>
<h4>Medications at discharge<a href="patterns.html#Medications_at_discharge" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: EXM104_FHIR-8.1.000_TJC.cql</p>

<pre>
<code>
define "Antithrombotic Therapy at Discharge":
    ["MedicationRequest": "Antithrombotic Therapy"] Antithrombotic
        where exists (Antithrombotic.category C where FHIRHelpers.ToConcept(C) ~ "Discharge")
            and Antithrombotic.intent = 'order'
</code>
</pre>

<p>Note that the FHIRHelpers.ToConcept usage is intended to be implicit and will be unnecessary once QUICK is fully supported.</p>

<a name="Medication_not_discharged"> </a>
<h4>Medication not discharged<a href="patterns.html#Medication_not_discharged" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<pre>
<code>
define "Antithrombotic Not Given at Discharge":
    ["MedicationRequest": "Antithrombotic Therapy"] NoAntithromboticDischarge
        // STU3
            where exists (
                NoAntithromboticDischarge.extension E
                    where E.url = 'http://hl7.org/fhir/us/davinci-deqm/STU3/StructureDefinition/extension-doNotPerform'
                        and E.value is true
		            )
		            // R4
		            //where NoAntithromboticDischarge.doNotPerform is true
			            and (singleton from NoAntithromboticDischarge.reasonCode in "Medical Reason"
				            or singleton from NoAntithromboticDischarge.reasonCode in "Patient Refusal")

// NOTE: On the assumption that status of not-taken is the closest to what the measure is looking for, this is the expression:
// Ballot-note: Request discussion w/ Pharmacy regarding how medications not prescribed at discharged would be documented
//define "Antithrombotic Not Given at Discharge R4":
//  ["MedicationStatement": "Antithrombotic Therapy"] AntithromboticTherapy
//	  where AntithromboticTherapy.status = 'not-taken'
//		  and (AntithromboticTherapy.statusReason in "Medical Reason"
//				or AntithrombtoicTherapy.statusReason in "Patient Refusal")
</code>
</pre>

<a name="Medication_not_administered"> </a>
<h4>Medication not administered<a href="patterns.html#Medication_not_administered" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: EXM108_FHIR</p>

<pre>
<code>
define "No VTE Prophylaxis Medication Administered":
    ["MedicationAdministration": medication in "Low Dose Unfractionated Heparin for VTE Prophylaxis"] MedicationAdm
        where MedicationAdm.status = 'not-done'
</code>
</pre>

<a name="Medication_not_ordered"> </a>
<h4>Medication not ordered<a href="patterns.html#Medication_not_ordered" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: EXM108_FHIR</p>

<pre>
<code>
define "No VTE Prophylaxis Medication Ordered":
    ["MedicationRequest": medication in "Low Dose Unfractionated Heparin for VTE Prophylaxis"] MedicationOrder
        where MedicationOrder.intent = 'order'
        and MedicationOrder.doNotPerform is true
</code>
</pre>

<p>Ballot-note: Note that the MedicationRequest status element is not being checked here. What is the status element expected to be for a MedicationRequest with doNotPerform set to true?</p>

<a name="Procedures/Interventions"> </a>
<h3>Procedures/Interventions<a href="patterns.html#Procedures/Interventions" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h3>

<p>Example source: EXM108_FHIR</p>

<pre>
<code>
define "Intervention Comfort Measures":
    (["ServiceRequest": "Comfort Measures"] P
        where P.intent = 'order')
    union
    (["Procedure": "Comfort Measures"] IntervetionPerformed
        where IntervetionPerformed.status = 'completed')
</code>
</pre>

<a name="Device_Use"> </a>
<h4>Device Use<a href="patterns.html#Device_Use" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: EXM108_FHIR</p>

<pre>
<code>
define "VTE Prophylaxis by Device Applied":
    (
            ["DeviceUseStatement": code in "Intermittent pneumatic compression devices (IPC)"]
        union ["DeviceUseStatement": code in "Venous foot pumps (VFP)"]
            union ["DeviceUseStatement": code in "Graduated compression stockings (GCS)"]
    ) DeviceApplied
            where DeviceApplied.status = 'completed'
    </code>
</pre>

<a name="Device_Not_Used"> </a>
<h4>Device Not Used<a href="patterns.html#Device_Not_Used" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: EXM108_FHIR</p>

<pre>
<code>
define "No VTE Prophylaxis Device Applied":
    (["DeviceUseStatement": code in "Venous foot pumps (VFP)"]
    union ["DeviceUseStatement": code in "Intermittent pneumatic compression devices (IPC)"]
    union ["DeviceUseStatement": code in "Graduated compression stockings (GCS)"]
    ) DeviceApplied
        where GetExtension(DeviceApplied.extension, 'http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-deviceusestatement-notDone').value is true
</code>
</pre>

<a name="Device_Not_Ordered"> </a>
<h4>Device Not Ordered<a href="patterns.html#Device_Not_Ordered" title="link to here" class="self-link"> <img src="target.png" width="20" class="self-link" height="20"/> </a></h4>

<p>Example source: EXM108_FHIR</p>

<pre>
<code>
define "No VTE Prophylaxis Device Ordered":
    ["DeviceRequest": code in "Venous foot pumps (VFP)"]
        union ["DeviceRequest": code in "Intermittent pneumatic compression devices (IPC)"]
        union ["DeviceRequest": code in "Graduated compression stockings (GCS)"]
    ) DevideOrder
        where DevideOrder.intent = 'Order'
            and GetExtension(DevideOrder.extension, 'http://hl7.org/fhir/StructureDefinition/request-doNotPerform').value is true
</code>
</pre>

</div>

{% include container-end.html %}

{% include footer.html %}
